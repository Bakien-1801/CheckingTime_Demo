import * as React from 'react';

import type { ListenerMap } from './NavigationBuilderContext';

/**
 * Hook which lets child navigators add action listeners.
 */
export default function useChildListeners() {
  const { current: listeners } = React.useRef<{
    [K in keyof ListenerMap]: ListenerMap[K][];
  }>({
    action: [],
    focus: [],
  });

  const addListener = React.useCallback(
    <T extends keyof ListenerMap>(type: T, listener: ListenerMap[T]) => {
<<<<<<< HEAD
      listeners[type].push(listener);

      let removed = false;
      return () => {
        const index = listeners[type].indexOf(listener);

        if (!removed && index > -1) {
          removed = true;
          listeners[type].splice(index, 1);
        }
=======
      // @ts-expect-error: listener should be correct type according to `type`
      listeners[type].push(listener);

      return () => {
        // @ts-expect-error: listener should be correct type according to `type`
        const index = listeners[type].indexOf(listener);

        listeners[type].splice(index, 1);
>>>>>>> 83ac694d3e88d047c1d1d5c699a6bbd6b4134212
      };
    },
    [listeners]
  );

  return {
    listeners,
    addListener,
  };
}
